<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">

<dom-module id="my-wachtwoordveranderen">
  <template>
    <style>
      :host > * {
        --paper-input-container-focus-color: #1a9fd9;
      }
      :host {
        display: block;
      }

      span {
        @apply --paper-font-body1;
      }
      .toast-button {
        text-transform: none;
        color: white;                           /* white tekst */
        background: #1a9fd9;                    /* kind of blue */
        --paper-button-ink-color: #00567B;      /* kind of dark blue */
        margin-left: 0px;
      }
      .usericondiv {
         @apply --layout-horizontal;
         @apply --layout-center-justified;
       }
      .my-icon {
        border: #D4D4D4 3px solid;
        border-radius: 150px;
        padding: 8px;
        --iron-icon-fill-color: #1a9fd9;
        height: 60px;
        width: 60px;
      }
      .my-input {
        padding-left: 8px;
        padding-right: 1px;
      }
      .my-button {
        width: 100%;
        color: white;
        background: #1a9fd9;
        --paper-button-ink-color: #00567B;
        margin-top: 5px;
      }
      .my-button[disabled] {            /* styling als de opslaan button disabled is. */
        background: lightgray;
        color: darkgray;
      }
    </style>

    <div class="usericondiv">
      <iron-icon icon="icons:perm-identity" class="my-icon"></iron-icon>
    </div>
    <div class="my-input">
       <paper-input id="oudwachtwoord_element" on-keydown="_checkForEnter" label="oudwachtwoord" type=String></paper-input>
       <paper-input id="nieuwwachtwoord_element" on-keydown="_checkForEnter" label="nieuwwachtwoord" type=String></paper-input>
    </div>

    <paper-button
      id="wachtwoordveranderen_button_element"
      class="my-button"
      on-click="_ophalen_wachtwoordveranderen_request_handler"
      raised>
        Inloggen
    </paper-button>

    <iron-ajax
      id="ajax_wachtwoordveranderen"
      method="POST"
      url="/wachtwoordveranderen"
      handle-as="json"
      on-response="_ophalen_wachtwoordveranderen_response_handler">
    </iron-ajax>

  </template>

  <script>
    (function() {
      'use strict';

      /* _xxxx private              : geen external data binding      - geen notify
         _c_xx private constant     : geen external binding, constant - geen notify
         c_xx  public constant      : one way external databinding [[c_xx]] - geen notify nodig
         xxxx  public               : two way external databinding {{xxxx}} - notify nodig
      */
      Polymer({

        _go_home: function() {
          var lApp = document.querySelector('my-app');  //het polymer element <my-app>
          var lAppRouter = lApp.$.approuter;            // het html-element <app-route> met id=approuter
          lAppRouter.data={page: ""};                   // vul het data attribute met de homepage url
                                                        // door de two way binding in <app-route> en <app-location>
                                                        // zal ook de url echt wijzigen
         },

         _ophalen_wachtwoordveranderen_request_handler: function() {
          console.log("_ophalen_wachtwoord_request_handler oudwachtwoord=" + this.oudwachtwoord);
          if (this.rol == "undefined") {
            this.$.ajax_wachtwoordveranderen.contentType="application/json";
            this.$.ajax_wachtwoordveranderen.body={
              "oudwachtwoord":this.oudwachtwoord,
              "nieuwwachtwoord":this._nieuwwachtwoord
            };
            this.$.ajax_wachtwoordveranderen.generateRequest();
          } else {
            var lToast = this.$.toast_reeds_aangelogd;     // meldt reeds aangelogd
            lToast.open();                                  /* het sluiten van deze error verwijst  */
                                                            /* terug naar home page */
          }
        },

        _ophalen_wachtwoordveranderen_response_handler: function(request) {
          console.log("_ophalen_wachtwoord_response_handler oudwachtwoord="+this.oudwachtwoord);
          this.rol = request.detail.response.rol;
          /* this._password = ""; /* om snel te kunnen testen is dit verwijderd */
          if (this.rol == "undefined") {                    //als aanloggen mislukt
            this.$.wachtwoord_element.invalid = true;           // markeer wachtwoord-element

          } else {                                            // als aanloggen ok
            this.$.oudwachtwoord_element.invalid = false;               // verwijder fout markering
            this.$.nieuwwachtwoord_element.invalid = false;          // verwijder fout markering
            this._go_home();                                    // ga naar de home page.
          }
        },

        _toast_clicked: function(e) {
          var lToast = e.path[1];       //path[0] is de button. path[1] is de owner etc.
          lToast.toggle();              //sluit de foutmelding
          this._go_home();              // en ga verder op de home page
        },

      });

    })();
  </script>
</dom-module>
